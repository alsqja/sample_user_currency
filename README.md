# User_Currency

# TechStack
JAVA : JDK 21

Spring Boot : 3.3.5

IDE : IntelliJ

MySQL : Ver 8.1.0

# ERD
<img width="960" alt="image" src="https://github.com/user-attachments/assets/0c55fddf-e6bd-49ec-a721-0361a66c7938">


# API
[API 링크](https://documenter.getpostman.com/view/18429295/2sAYBXBr72)

# 기능
## Lv 1. 고객(User)과 통화(Currency) 복잡한 연관관계 `필수`

- [x]  **환전 요청 중간 테이블 생성**
    - [x]  필드: `고객 고유 식별자`, `환전 대상 통화 식별자`, `환전 전 금액`, `환전 후 금액`, `상태`

- [x]  **고객과 통화 테이블 간 연관관계**
    - [x]  한 고객이 여러 통화로 환전할 수 있고 한 통화는 여러 고객들에 의해 환전될 수 있습니다.
    - [x]  `환전 요청 테이블`은 중간 테이블이고 `User`와 `Currency` 간 관계를 관리합니다.

## Lv 2. 환전 요청 CRUD `필수`

- [x]  C: 환전 요청 수행
    - [x]  `환전 대상 통화 식별자`가 `Currency` 테이블에 가지고 있는 환율을 기준으로 환전을 수행합니다.
    - [x]  환전 후 금액은 환전 전 금액을 환율로 나눈 결과입니다.
        - `환전 후 금액` 계산식 (참고)
            - [x]  `환전 후 금액 = 환전 전 금액 / 환율`    
    - [x]  `환전 후 금액`에 대해 소수점 두번째 반올림 수행
- [x]  R: `고객 고유 식별자`를 기반으로 특정 고객이 수행한 환전 요청 조회
    - [x]  조건
        - [x]  `고객 고유 식별자`: 환전 요청 테이블에 있는 User ID
- [x]  U: 특정 환전 요청 상태를 취소로 변경
    - [x]  상태 값은 `normal`, `cancelled`
- [x]  D: 고객이 삭제될 때 해당 고객이 수행한 모든 환전 요청도 삭제
    - [x]  키워드
        - [x]  `영속성 전이`, `cascade`

## Lv 3. 예외 처리 `필수`

- 모든 상황에 대해 유효성 검사와 예외 처리를 구현하지 않아도 됩니다. 핵심적으로 중요하다고 생각하는 1~2가지 항목에 대해 수행하면 충분합니다.
- [x]  **유효성 검사 추가**: 입력 값에 대한 유효성 검사를 추가하여 정책에 맞는 데이터만 취합
    - [x]  `3-Layered Architecture` 에서 유효성 검사가 어떤 계층의 책임인지 고민해보세요!
    - [x]  이메일, 일자 데이터, 길이 등
    - [x]  키워드
        - [x]  `Validation`
- [x]  **예외 처리 강화**: 적절한 예외 처리 로직을 추가하여 오류 발생 시 사용자에게 명확한 피드백 제공
    - [x]  API 예외처리
        - [x]  키워드
            - [x]  `GlobalExceptionHandler`
    - [x]  단순히 400, 500 에러코드만 보내지 않고 더 많은 정보를 포함하여 에러 메세지를 전달
            - [x]  요청값의 형식이 맞지 않습니다.
            - [x]  네트워크 요청에 실패했습니다. 다시 시도해주시기 바랍니다.
            - [x]  코드 형태를 고민해봐도 좋겠습니다.

## 3️⃣ 도전 기능

## Lv 4. PostConstruct 적용 `도전`

- [x]  조건
    - [x]  스프링이 구동될 때 통화 테이블에 있는 환율이 0이거나 음수이거나 지정된 범위를 벗어나는 경우
- [x]  유효하지 않은 값으로 간주하고 로그를 기록하세요.
- [x]  키워드
    - [x]  `@Component`, `@Slf4j`

## Lv 5. JPQL `도전`

- [x]  고객의 모든 환전 요청을 그룹화하여 조회
- [x]  반환해야하는 컬럼
    - [x]  해당 고객이 수행한 환전 요청 데이터들의 총 row 수
    - [x]  해당 고객이 환전을 요청한 총 금액
- [x]  키워드
    - [x]  `@Query`, `Group By`, `SUM`, `COUNT`

## Lv 6. 달러 이외 통화를 환전할 수 있도록 수정 `도전`

- [x]  `Currency` 테이블에 다른 통화에 대한 데이터를 추가합니다.
- [x]  현재는 달러를 기준으로 개발하였습니다. 그래서 다른 통화로 환전하면 자리수가 맞지 않는 경우가 존재합니다.
    - [x]  각 통화마다 다른 자리수를 적용하도록 개발합니다.

